# ドライバー飛距離の簡易推定（2次元モデル）

## 目的
このページの目的は、**ドライバー飛距離の簡易推定**です。  
入力したボール初速と打ち出し角をもとに、2次元の弾道計算で**キャリー**と**トータル**を概算します。

---

## モデルの前提（2次元弾道計算）
- 計算は鉛直面内の**2次元**（水平 x / 鉛直 y）。
- 初期条件は、打ち出し時の
  - ボール初速 `v0`
  - 打ち出し角 `θ`
- ボールに作用する外力は以下の3つのみ。
  1. 重力
  2. 一定の揚力（`Cl` を定数）
  3. 抗力（`Cd` を定数）
- 風・スピン減衰・姿勢変化・空気密度の高度依存・地面傾斜は無視。

運動方程式（速度ベクトル `v=(vx, vy)`、`|v|=sqrt(vx²+vy²)`）:

- 抗力: `F_d = 1/2 * ρ * Cd * A * |v|²`
- 揚力: `F_l = 1/2 * ρ * Cl * A * |v|²`（速度に直交する向き）
- 加速度:
  - `ax = (-F_d * vx/|v| - F_l * vy/|v|) / m`
  - `ay = (-g - F_d * vy/|v| + F_l * vx/|v|) / m`

数値積分は固定刻み `dt` のオイラー法（または同等の単純積分）を想定します。

### 軌道計算の手順（実装イメージ）
1. 入力 `v0, θ` から初期速度を分解
   - `vx = v0 * cos(θ)`
   - `vy = v0 * sin(θ)`
   - `x = 0`, `y = h0`（通常は `h0 = 0`）
2. 時間ループ（`y >= 0` の間）
   - `v = sqrt(vx² + vy²)`
   - `Fd = 0.5 * ρ * Cd * A * v²`
   - `Fl = 0.5 * ρ * Cl * A * v²`
   - `ax = (-Fd * vx/v - Fl * vy/v) / m`
   - `ay = (-g - Fd * vy/v + Fl * vx/v) / m`
   - `vx += ax * dt`, `vy += ay * dt`
   - `x += vx * dt`, `y += vy * dt`
3. `y` が 0 を下回ったら、直前ステップと線形補間して着地点 `Carry_m` を求める
4. 着地時速度（`v_x,land`, `v_y,land`）からラン `Run_m` を計算
5. `Total_m = Carry_m + Run_m` を返す

### 擬似コード
```text
input: v0, theta_deg
const: rho, Cd, Cl, m, A, g, dt, eps

theta = deg2rad(theta_deg)
vx, vy = v0*cos(theta), v0*sin(theta)
x, y = 0, h0

prev = (x, y, vx, vy)
while y >= 0:
    v  = max(sqrt(vx*vx + vy*vy), eps)
    Fd = 0.5*rho*Cd*A*v*v
    Fl = 0.5*rho*Cl*A*v*v

    ax = (-Fd*vx/v - Fl*vy/v)/m
    ay = (-g - Fd*vy/v + Fl*vx/v)/m

    vx = vx + ax*dt
    vy = vy + ay*dt
    x  = x  + vx*dt
    y  = y  + vy*dt

    if y < 0:
        carry = linear_interpolate_x_at_y0(prev, (x,y,vx,vy))
        vx_land, vy_land = interpolate_v_at_y0(prev, (x,y,vx,vy))
        break
    prev = (x,y,vx,vy)

gamma = atan(abs(vy_land) / max(vx_land, eps))
run   = max(0, k_run * vx_land*vx_land * cos(gamma))
total = carry + run
```

---

## 計算式・固定定数・単位系

| 区分 | 記号/項目 | 値・式（本仕様） | 単位 |
|---|---|---|---|
| 入力 | 初速 | `v0` | m/s |
| 入力 | 打ち出し角 | `θ` | degree |
| 固定仕様 | バックスピン | 最適値で固定（例: `2500`） | rpm |
| 係数 | 抗力係数 | `Cd = 0.25`（一定） | - |
| 係数 | 揚力係数 | `Cl = 0.20`（一定） | - |
| 物理定数 | 空気密度 | `ρ = 1.20` | kg/m³ |
| 物理定数 | 重力加速度 | `g = 9.80665` | m/s² |
| 物理定数 | ボール質量 | `m = 0.04593`（最大） | kg |
| 物理定数 | ボール直径 | `d = 0.04267`（最小） | m |
| 派生量 | ボール半径 | `r = d/2` | m |
| 派生量 | 断面積 | `A = πr²` | m² |
| 出力 | キャリー | 着地時の `x` 距離 | m / yd |
| 出力 | トータル | `キャリー + ラン` | m / yd |
| 換算 | ヤード換算 | `1 yd = 0.9144 m` | yd/m |

> 単位系は SI（m/s, kg, m）を基準にし、表示時に yd へ換算します。

---

## スピン仕様
- 本仕様では、**スピンは最適値固定**（定数）として扱います。
- したがって、`Cl` も固定値として計算に使用します。

### 拡張案（将来対応）
- スピン（rpm）をユーザー入力化し、`Cl = f(Spin, Re)` の近似式（またはテーブル補間）へ置き換える。
- あわせて `Cd` も速度域やスピンパラメータに応じて可変化する。

---

## キャリーとトータルの定義
- **キャリー**: 打ち出しから最初の着地点までの水平距離。
- **トータル**: キャリーに、着地後の**ラン（転がり距離）**を加えた距離。

### ラン計算（本仕様）
本仕様では、ランは**「2. 着地速度・着地角からの簡易近似」**で計算します。  
（固定値加算は採用しません）

- 着地時の水平速度: `v_x,land`
- 着地時の入射角（下向き）: `γ = atan(|v_y,land| / max(v_x,land, ε))`
- 簡易ラン近似:

`Run_m = k_run * v_x,land² * cos(γ)`

- `k_run` は地面コンディション係数（初期値例: `0.010`）
- `Run_m >= 0` にクリップ
- `Total_m = Carry_m + Run_m`

> 備考: `k_run` はフェアウェイ硬さ・芝・湿りで変動するため、実測に合わせてキャリブレーションが必要です。

---

## 免責
この推定値は簡易物理モデルにもとづく概算です。  
**実測値・弾道計測器（ローンチモニター）の結果とは差が出る場合があります。**

---

## 係数・ボール仕様の参照（最新版ベース）
`Cd` / `Cl` の初期値は、**2010年以降の公開情報**を優先して設定します（旧い文献参照は除外）。

1. The R&A / USGA, *Equipment Rules*（最新版）
   - ゴルフボールの質量上限（45.93 g）、直径下限（42.67 mm）
2. 住友ゴム工業（DUNLOP / SRIXON）の公開技術情報（2020年代）
   - ディンプル設計・揚抗特性の説明資料を `Cd` / `Cl` 調整根拠として利用
3. 2010年以降の CFD / 風洞系公開資料（メーカー技報・学会資料）
   - 代表レンジ（実装初期値）: `Cd = 0.22–0.28`, `Cl = 0.16–0.24`

> 補足: `Cd` と `Cl` は速度（Re数）・スピン量・ディンプル形状で変化します。現行実装は固定係数の簡易モデルであり、将来的にスピン入力連動の可変係数モデルへ拡張します。
